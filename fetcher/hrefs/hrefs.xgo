/*
 * Copyright (c) 2026 The XGo Authors (xgo.dev). All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package hrefs

import (
	"github.com/goplus/hdq"
	"github.com/goplus/hdq/fetcher"
)

// Result represents the result of hrefs fetcher.
type Result struct {
	URL   string   `json:"url,omitempty"`
	Hrefs []string `json:"hrefs,omitempty"`
}

// New extracts hrefs from the given document and returns the Result.
func New(input any, doc hdq.NodeSet) Result {
	hrefs := [url for a in doc.**.a if url, _ := a.$href; url != ""]
	return {input.(string), hrefs}
}

// URL returns the URL from the input.
// Input is expected to be a URL, and the fetcher will extract all hrefs
// from the page at that URL.
func URL(input any) string {
	return input.(string)
}

func init() {
	fetcher.register("hrefs", New, URL)
}
